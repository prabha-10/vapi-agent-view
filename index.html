<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Assistant Demo</title>
    <script src="https://cdn.jsdelivr.net/npm/@vapi-ai/web/dist/vapi.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #2563eb;
            --bg: #0f172a;
            --card: #1e293b;
            --text: #f8fafc;
            --subtext: #94a3b8;
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
        }
        .container {
            background-color: var(--card);
            padding: 40px;
            border-radius: 24px;
            text-align: center;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }
        h1 { margin: 0 0 10px 0; font-size: 24px; }
        p { color: var(--subtext); margin-bottom: 30px; }
        
        .mic-button {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background-color: var(--primary);
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto;
            box-shadow: 0 0 0 0 rgba(37, 99, 235, 0.7);
        }
        .mic-button svg { width: 32px; height: 32px; fill: white; }
        
        /* Active State Animation */
        .mic-button.active {
            background-color: #ef4444;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
            70% { box-shadow: 0 0 0 20px rgba(239, 68, 68, 0); }
            100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
        }

        .status { margin-top: 20px; font-size: 14px; color: var(--subtext); }
        
        /* Hide if config missing */
        .error { color: #ef4444; display: none; margin-bottom: 20px; }
    </style>
</head>
<body>

<div class="container">
    <div id="error-msg" class="error"></div>
    <h1 id="agent-name">Voice Assistant</h1>
    <p>Tap below to start the conversation</p>

    <button id="vapi-btn" class="mic-button">
        <svg viewBox="0 0 24 24"><path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/><path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/></svg>
    </button>

    <div class="status" id="status-text">Ready to connect</div>
</div>

<script>
    // 1. Get Params from URL
    const urlParams = new URLSearchParams(window.location.search);
    const publicKey = urlParams.get('key'); // Your Public Key
    const assistantId = urlParams.get('id');  // The Agent ID from n8n
    const agentName = urlParams.get('name') || "Voice Assistant";

    // 2. Setup UI
    document.getElementById('agent-name').innerText = agentName;
    const btn = document.getElementById('vapi-btn');
    const statusText = document.getElementById('status-text');
    const errorMsg = document.getElementById('error-msg');

    if (!publicKey || !assistantId) {
        errorMsg.innerText = "Missing API Key or Assistant ID in URL";
        errorMsg.style.display = "block";
        btn.disabled = true;
    }

    // 3. Initialize Vapi
    const vapi = new Vapi(publicKey);
    let isActive = false;

    btn.addEventListener('click', () => {
        if (!isActive) {
            vapi.start(assistantId);
            statusText.innerText = "Connecting...";
        } else {
            vapi.stop();
        }
    });

    // 4. Handle Events
    vapi.on('call-start', () => {
        isActive = true;
        btn.classList.add('active');
        statusText.innerText = "Listening...";
    });

    vapi.on('call-end', () => {
        isActive = false;
        btn.classList.remove('active');
        statusText.innerText = "Call ended";
        setTimeout(() => statusText.innerText = "Ready to connect", 2000);
    });

    vapi.on('error', (e) => {
        console.error(e);
        statusText.innerText = "Connection Error";
        isActive = false;
        btn.classList.remove('active');
    });
</script>

</body>
</html>
